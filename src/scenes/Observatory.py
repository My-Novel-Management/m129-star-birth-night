# -*- coding: utf-8 -*-
'''
Stage: "天文台"
'''
import os
import sys
sys.path.append(os.path.join(os.path.dirname(__file__), '../..'))
sys.path.append('storybuilder')
from storybuilder.builder.world import World


## scenes
def mystery_oldman(w: World):
    yazaki, shino, chito = w.get('yazaki'), w.get('shino'), w.get('chito')
    return w.scene('謎の老人',
            # NOTE: ここはomit
            w.cmd.change_stage("Observatory"),
            w.plot_note("苔むした天文台に忍び込んだ老人は、その望遠鏡のところまできてそこに宝箱を発見して、微笑する。夢と書かれた紙切れが入っていた"),
            )


def missing_star_world(w: World):
    yazaki, shino, chito = w.get('yazaki'), w.get('shino'), w.get('chito')
    return w.scene("星が消えた世界で",
            w.cmd.change_camera("yazaki"),
            w.cmd.change_stage("Observatory"),
            w.plot_note("まだ天文台が稼働していた頃、夜空を見上げてはため息をついていた$yazaki"),
            w.plot_note("この世界ではいつからか星が見えなくなっていた"),
            w.plot_note("夜、天文台にいつものように忍び込んできた$chitoがやってきて「今日も星が見えないね」と残念そうに言う"),
            w.plot_note("$yazakiは彼に星というのは遠くの光が観測できるようになったもので、ひょっとすると全ての星が消滅してしまったのかも知れないと言う"),
            w.plot_note("$chitoはどうしても図鑑で見た星空が見たくて、$yazakiに星を作って欲しいとお願いする"),
            w.plot_note("しかし$yazakiは「星なんて作れるはずがない」と断言する"),
            w.plot_note("翌日、天文台には閉鎖通知が届いた"),
            "天文台構造：B1fが展示室／１ｆ事務室・エントランスホール／２ｆ観測室・展望所",
            "天文台の描写。時間帯は夜。夜空は真っ暗な様も",
            yazaki.be("#観測室で望遠鏡を覗いている$S"),
            yazaki.do("白熱球の小さな明かりを更に弱くして$Sはドームのスリットから肉眼で夜空を見上げた",
                "そこはべったりとした一面の闇が覗き、観測すべき星の一つも見つけられない",
                "彼は前髪を切り過ぎて狭い露出してしまった額に手を当て、小さくため息をつく"),
            "$yazakiの見た目。服は白衣をだらりと着て。髪は自分でカットしていて、不正確",
            yazaki.do("今日も宇宙に星は見えない"),
            shino.come(),
            shino.talk("主任", "動かしてたらまた台長に文句言われますよ"),
            yazaki.do("声がして顔を上げると、観測室の明かりを点けた$full_shinoが苦笑を貼り付けて$Sを見ていた",
                "彼女は既に白衣を脱ぎ、その手に薄手のコートを畳んで掛けている", "もう帰るところなのだ"),
            yazaki.talk("メンテナンスだよ", "確認しておかないといざ星が見つかったって時にちゃんと動くかどうか分からないだろう？"),
            shino.do("はいはい、という体で彼女は一度お辞儀を見せると「事務室の消灯も忘れないで下さい」と釘を差してからドアを閉めて階段を降りていった"),
            shino.go(),
            yazaki.do("$Sは「分かってるよ」とわざわざ声に出すと、名残惜しそうに操作卓のボタンを押してドームを閉める",
                "その小さな振動を感じながら「星がなくなってしまった世界での天文台は税金の無駄遣いだ」という電話が掛かってきたことを思い出してしまい、",
                "またため息が落ちた",
                "スタッフはこの春二人辞め、次は$shinoか自分の番だろう", "ずっと天文馬鹿だった$Sはこの天文台と同じだ",
                "必要とされないなら、やがて消えるのが道理だった"),
            "この先翌日にする",
            w.br(),
            shino.come("#$chitoと一緒にやってくる"),
            chito.come(),
            "$chitoの外見。天然パーマで目がくりっとしている。鼻の頭が汚れていて、泥遊びでもしていたのかと思わせる",
            "$nomuraに小屋で色々機械のことを教わったりしていた",
            chito.talk("先生！"),
            yazaki.talk("先生じゃないと言ってるだろう、$chito"),
            yazaki.do("翌朝、事務仕事を片付けてコーヒーでも飲もうかと思っていたところに、赤鼻の男の子が見慣れた天然パーマを揺らして駆け込んできた",
                "近所に住んでいる$chitoという小学生だが、何が気に入ったのか開館日には必ず顔を出しては$Sに星の話を聞いては目を輝かせている"),
            chito.talk("学校の先生よりよっぽど先生だから先生でいいの！", "それより星見つかった？"),
            yazaki.do("一週間ほど前に小さい頃には肉眼でも星が見えたという話をしてから自分も見たいと言ってきかないのだ"),
            yazaki.talk("何度も言ったと思うがね、$chito",
                "星はそんなに簡単には見つからない",
                "世界中の様々な研究者や個人の天文愛好者が星の光を探し続けている",
                "でも誰一人として見つかったという報告を上げられない",
                "国際天文連は地球孤立説を本気で採用しようとしているくらいお手上げ状態なんだ",
                "太陽以外の星は全て消え去ってしまった",
                "今や多くの学者がその考えを正しいと認めざるを得ない状況で"),
            chito.talk("でも昔は見えたんでしょ！", "それもこーんなにいっぱいの、河原に蛍を何百匹って解き放った以上の光の洪水を、",
                "先生たちは見たんでしょ！",
                "だったらそんなに簡単に星なくなんないって！", "みんな本気で探してるの？"),
            yazaki.do("何と答えたものか、という苦笑を$full_shinoに向けると彼女も同じように困った顔をしてパソコンのモニタに隠れてしまった"),
            "事務室に移動がてら、天文台の構造を簡単に説明",
            "事務室描写。いろいろと予算がなさそうな有様",
            chito.talk("もういいよ", "星は$meが見つけるから！",
                    "それより先生、今日は何を教えてくれるの？",
                    "この前理科の授業のときに星はガスから生まれるんだって教えたらみんなすっごく驚いてたよ"),
            yazaki.talk("そうだなあ"),
            yazaki.do("$Sは立ち上がり、後ろに並んだスチール製のキャビネットに収まっている分厚い図鑑や書籍を適当に手に取る",
                    "三割程度が$S自身の持ち込み品だったが小学生に教えられそうな簡単な内容のものはこの事務室にはあまりなかった"),
            yazaki.talk("$shino、ちょっとホールの方に行ってくるよ"),
            shino.talk("分かりました",
                    "あ、けど主任",
                    "先程の書類には何と返事をしておけばいいんですか？"),
            yazaki.talk("返事をするといっても$meたちに選択肢がある訳じゃないからね"),
            yazaki.do("それでも腕組みをして五秒ほど考えると「あとで$meがメールで返事をしておく」とだけ伝え、",
                    "$chitoを伴って部屋を出た"),
            chito.talk("先生、何かあったの？"),
            yazaki.do("クリーム色の廊下を歩いてホールに向かう",
                    "自分の半分くらいの身長の$chitoがそのキラキラした瞳で無垢な質問をぶつけてくるのが時々辛いこともあった"),
            yazaki.talk("仕事の話だ", "心配することはないよ",
                    "それより今日はどんな話をしようかな"),
            yazaki.do("これまで$chitoには地球という惑星や太陽系について、星に関する色々な不思議、ギリシャ時代に作られた多くの星座に関する逸話を話して聞かせたりした",
                    "$Sが得意とするのは物理方面だが数式の話をしても流石にまだ理解はしてもらえないので、",
                    "興味を惹きそうな話題を振るのだけれど、いい加減にそういうネタも無くなりつつある"),
            chito.talk("ねえねえ先生！", "これもっかい教えてよ！"),
            yazaki.do("そんな$Sのことは構わずに$chitoはホールに駆け込むと、図書コーナーに真っ先に向かい、そこから『星の誕生』という大判の本を取り出した",
                    "星がどうやって生まれ、どうやって死ぬのか",
                    "それが沢山の図解を交えて丁寧に説明されている"),
            yazaki.talk("本当にその本が好きだな、$chitoは"),
            chito.talk("好きとかじゃない", "星を作るんだ！"),
            yazaki.do("そんなことをてらいもなく口に出来るのは何も知らない強さだろうか",
                    "ああ分かった、と答えながらパイプ椅子に掛けると、テーブルに本を広げて『宇宙の誕生』の項から、何度目になるか分からない講義を始めた"),
            )


def create_star(w: World):
    yazaki, shino, chito = w.get('yazaki'), w.get('shino'), w.get('chito')
    return w.scene("星を作ろう",
            w.plot_note("天文台にやってきた$chitoは閉鎖通知を知り、それなら尚の事、星を作るべきだと主張する"),
            w.plot_note("星があれば天文台は存続できるし、自分も星を見れていいからと"),
            w.plot_note("仕方なく$yazakiは簡単にできる打ち上げ式の発光体で誤魔化すことにした"),
            "ペットボトルを使ったロケットでは２００ｍくらいは簡単に上がる。最高記録はカーボンファイバを使ったもので８３０ｍ",
            w.plot_note("$yazakiが作ったのは２００ｍほど打ち上がるペットボトルロケットで、その先にＬＥＤライトの先端を取り付けた"),
            w.plot_note("実験の日、こっそりやってきた$chitoは両親に色々と叱られているという。本人は気にしていないが、噂で天文台が悪い場所だと吹聴していると聞いた"),
            w.plot_note("ロケットを打ち上げると$chitoはそれに感動するが、光はすぐに消えてしまった"),
            w.plot_note("それを見せて「星は無理だよ、$chito」と諭す"),
            w.plot_note("けれど$chitoはもっと大きなロケットでいっぱい星を乗せればいいと考え、自作すると言い出した"),
            yazaki.be(),
            shino.be(),
            chito.be(),
            chito.talk("どうしたの？　ここ、なくなるの？"),
            yazaki.talk("星が観測できないなら、天文台は必要ないからね", "いずれこういう日が来るとは思っていたよ",
                "そうならないようにプラネタリウムなんかも準備していたのだけれど、予算も削られて"),
            chito.talk("星がなければ作ればいいんだよ！"),
            "星誕生の流れ。分子雲が形成＞濃い部分が原始星になる＞ガスの塊で核融合反応を始めて光る",
            yazaki.talk("$chito、君は今まで何を勉強してきたんだい？",
                "星というのは人間が作れるようなものではなくてね"),
            chito.talk("先生がいつも言う科学の力ってそんなものかよ！", "駄目というんじゃなくて創意工夫とトライアンドエラーなんだろ？"),
            yazaki.talk("星は作れないかも知れないが、光を星に見立てて空に上げるくらいなら"),
            chito.talk("それでも充分だよ！", "先生、$me、星が見たいんだ",
                "いつも真っ暗な夜しか知らない$meたちが、本当なら見てたかもしれない、あのプラネタリウムみたいな星空を！"),
            yazaki.explain("こうして簡単なロケットを製作することになった"),
            )


def chitos_creation(w: World):
    yazaki, shino, chito = w.get('yazaki'), w.get('shino'), w.get('chito')
    nomura = w.get('nomura')
    return w.scene("$chitoの工作",
            w.plot_note("それから$chitoは毎日天文台に通ってきてはロケット工作をするようになる"),
            w.plot_note("図鑑などで勉強して、火薬を使えばいいという知識を手に入れた$chito"),
            yazaki.be("$chitoとペットボトルロケットを作っている"),
            chito.be("気難しい顔で取り組んでいる"),
            chito.talk("痛っ"),
            yazaki.talk("気をつけないとカットした断面は結構皮膚を傷つけやすくなっているから"),
            chito.talk("これくらい大丈夫だよ"),
            chito.do("真剣に取り組んでいる"),
            nomura.come("やってくる髭面の男性"),
            nomura.talk("おお、先生。やってるねー"),
            chito.talk("$nomura！"),
            nomura.talk("おっす", "工作教えてもらってんのか？"),
            chito.talk("工作じゃないやい", "星を作ってんだ"),
            nomura.talk("星とはまた大きく出たな", "で先生", "こいつ置いとくな"),
            nomura.do("メンテ用の部品を持ってきた$S"),
            nomura.talk("しかしいくら予算削られてるからって望遠鏡の整備まで先生がやんなくたってさ"),
            yazaki.talk("貧乏なのは慣れてますから", "大学の研究室にいたときも色々自作させられてたし"),
            nomura.talk("そういやプラネタリウム直さないのかい？", "学校の先生も星が見えない今、星を見せてあげられる唯一のものだって言ってましたよ"),
            yazaki.talk("投影機構は$nomuraさんたちでも何とかなるかも知れないけど、さすがに恒星原盤は職人の領域ですよ",
                "今は修理に応じてくれるメーカーも一社になってしまって、うちではちょっと手が出せませんね"),
            chito.talk("$meが星を作るから大丈夫だよ！", "先生、次は！"),
            yazaki.talk("ああ、ごめんごめん"),
            yazaki.do("水と空気による推進力を得るという原理を説明しつつ、一番シンプルなペットボトルロケットを製作する"),
            )


def chito_burned(w: World):
    yazaki, shino, chito = w.get('yazaki'), w.get('shino'), w.get('chito')
    dad, mam = w.get('dad'), w.get('mam')
    return w.scene("$chitoの火傷",
            w.cmd.change_stage("Observatory"),
            w.plot_note("ある日、天文台に$chitoの両親がやってくる"),
            w.plot_note("家でこっそり実験していて$chitoが火傷をしたというのだ"),
            w.plot_note("もうやめさせてください、と言い、二度と天文台には近づかせないと宣言された"),
            w.plot_note("誰も来なくなった天文台で、$yazakiたちは閉館の準備を始めていた"),
            yazaki.be("事務室で事務仕事をしている"),
            shino.be("コーヒーを淹れようと席を立つ"),
            shino.talk("コーヒー飲みますけど主任も淹れましょうか？"),
            yazaki.talk("ああ、頼む", "最近ずっと$chitoに付き合ってたから色々仕事溜まっちゃっててね"),
            shino.do("はい、と微笑み"),
            dad.come("そこに大柄な男が乗り込んでくる"),
            dad.talk("おい！"),
            yazaki.talk("ああ、$chito君のお父さん", "どうされました？"),
            dad.talk("あんたのせいでうちの息子が火傷を負ったんだよ！"),
            yazaki.talk("え？　どういうことです？"),
            yazaki.explain("ペットボトルロケットでは火薬を使うようなことは教えていなかったが、",
                "$chitoの父親から聞いたところ、図書館で借りてきたロケットの作り方を見て、",
                "火薬を使えばもっと空高くまでペットボトルロケットを飛ばせるんじゃないかと考えたらしい",
                "火薬は花火から取り出したものを使ったそうだが、誤って引火し、それで火傷を負ったようだ"),
            yazaki.talk("数日前から見なくなったと思ったらそんなことをしていたんですね",
                "一度ペットボトルロケットを作ってあまり高く飛ばないことに意気消沈していたんですが、",
                "あの子がそこまで考えるとは思っていませんでした",
                "申し訳ありません"),
            dad.talk("これがあんたの言う科学ってやつの結果か？", "うちの子には幸せにする技術だと教えているそうじゃないか",
                "聞いて呆れるな"),
            dad.go("怒ったまま出ていってしまう"),
            yazaki.do("苦笑する"),
            )


def planetarium(w: World):
    yazaki, shino, chito = w.get('yazaki'), w.get('shino'), w.get('chito')
    nomura = w.get('nomura')
    return w.scene("プラネタリウム",
            w.cmd.change_stage("Observatory"),
            "予算が削られすぎて、古くなって稼働しなくなっていたものを復旧させる、という風に",
            w.plot_note("天文台が閉鎖になる前に、せめて町の子どもたちに星を見せようと、プラネタリウムを作ることを考える"),
            w.plot_note("知り合いの技術者に連絡を取り、助手の$shinoの力も借りて、ホールに天幕を張り巡らし、そこにプラネタリウムを作り出す"),
            yazaki.be("天文台のホールにあるプラネタリウムを修理していた"),
            shino.come("書類を手にやってくる$S"),
            shino.talk("もうここ閉館になるんですよ、主任", "分かってます？"),
            yazaki.talk("ああ"),
            nomura.be("一緒に作業している"),
            nomura.talk("ここ、全部$ledに取り替えればいいんだな？", "光量とか強度とかは？"),
            yazaki.talk("そこの資料に計算して書いてある"),
            nomura.talk("どれだよ？"),
            yazaki.do("床に手書きの紙が散乱している"),
            yazaki.explain("自分たちで直せる部分は直して、原盤は修理を知古の町工場に出して直してもらうことになった"),
            yazaki.do("ただ$chitoは一度も姿を見せないまま、閉館式の日を迎えてしまった"),
            )


def closing_ceremony(w: World):
    yazaki, shino, chito = w.get('yazaki'), w.get('shino'), w.get('chito')
    mam, dad = w.get('mam'), w.get('dad')
    nomura = w.get('nomura')
    return w.scene("閉館式",
            w.plot_note("閉館式当日、なんとかプラネタリウムが完成した。多くの人が手伝ってくれるようになっていた"),
            w.plot_note("だがそこに$chitoの姿はなかった"),
            w.cmd.change_stage("Observatory"),
            yazaki.be("閉館式当日"),
            nomura.be("機械整備をしている"),
            yazaki.do("プラネタリウムの準備をしていた$S"),
            shino.be("準備を手伝っている"),
            dad.come("慌てて駆け込んでくる$S"),
            dad.talk("おい！　うちの息子はどこだ？"),
            yazaki.talk("ああ、$dadさん", "ここ最近ずっと見てません", "家か学校じゃないんですか？"),
            mam.come(),
            mam.talk("どこにもいないのよ", "$chito、どこにいってしまったの"),
            yazaki.talk("すみません！　$chito君がいなくなったそうなんです",
                "みなさんで探すのを手伝ってもらえないでしょうか？"),
            nomura.talk("こっちはどうする？　準備が間に合わないぞ？"),
            yazaki.talk("じゃあ$nomuraさんたちはここをお願いします",
                "とにかく$meらは$chito君を探しにいきます"),
            yazaki.go("あとを任せて外に走り出る"),
            )


def ovserbation(w: World):
    yazaki, shino, chito = w.get('yazaki'), w.get('shino'), w.get('chito')
    return w.scene("星の観測",
            w.plot_note("慌てて$yazakiは天文台に戻り、それを観測した"),
            w.plot_note("それは今までに見たことのない星だった"),
            w.plot_note("すぐに連絡を入れる", "しかし一度決まったものは覆らないと役所の人間に言われてしまった"),
            w.plot_note("$yazakiは$shinoを誘い、夢を打ち上げる事業を始めると口にした"),
            w.cmd.change_stage("Observatory"),
            yazaki.come("慌てて天文台に戻ってきた$Sは焦って階段を何度か踏み外しながらも転がり込むように観測室に飛び込んだ"),
            yazaki.talk("えっと、確か二時の方角だったから……"),
            yazaki.do("息を整える間すらもったいなくて、制御板の電源をオンに切り替え、望遠鏡制御用$pcを起動する",
                "古い型だからブゥゥンという低い音をさせてから画面が明るくなるまでにメモ帳を開いて忘れないように記録を書き込む",
                "日付と時刻、それに天候と発見状況",
                "指が震えてペン先が何度もずり落ちた"),
            yazaki.talk("これが観測できなかったら一体何のために今までやってきたのか分からなくなる"),
            yazaki.do("操作卓のボタンで換気窓を東、西、南と全て開ける",
                "すっと夜の心地よい空気が滑り込んできて外気との差を薄くしていく",
                "北側にやや雲が掛かっているが観測には支障がないだろう",
                "操作卓の右手のスイッチを下げる",
                "小さな振動が足から伝わってくる",
                "ドームスリットが開いているのだ"),
            yazaki.do("かつてなら見上げれば星空が見えただろう", "月明かりもあったかも知れない",
                "しかし今はただそこには闇が広がっているだけだ"),
            yazaki.do("ミラーカバーも開いたことを確認すると望遠鏡を追尾モードにして操作卓のレバーを握る",
                "微妙な力加減で西側に少し倒すとずりずりと巨大な望遠鏡のテーブルが動いて向きを変えた",
                "モニタを注視しつつ、そこにさっき$chitoが見つけた光の粒が捉えられるまで方向を変えていく"),
            yazaki.think("――これだ"),
            yazaki.do("最初は視認できるかどうかギリギリの小さな光だった",
                "ボタンを押してフォーカスをアップさせる", "その光は徐々に大きくなる",
                "ちょうど一ミリくらいの大きさに映っている光の座標を計算させて天球座標を割り出す"),
            shino.come(),
            shino.talk("主任！"),
            shino.do("望遠鏡が動いているのを見て駆けてきたのだろう",
                "$Sは観測室に入るなり手元のライトを消し、$yazakiとアイコンタクトを取ると彼が走り書きしたメモを持って事務室へと降りていった"),
            chito.come(),
            chito.talk("先生？　あれって星だよね！", "本当に本物の星なんだよね？"),
            chito.do("観測室のドアを開けた$Sの顔を、白熱球の淡い光が照らす", "&"),
            yazaki.think("その満面の笑みこそが正に星そのものだと$Sには思えたが、$shinoが衛星や航空機などの人工の発光体の確認をしてくれているから、",
                "その報告を待った"),
            shino.talk("主任！"),
            yazaki.do("十五分ほどして駆け込んできた彼女の笑顔にやっと$Sは頷くと、$chitoを前にこう言った"),
            yazaki.talk("あれが、星だよ", "$chitoが見つけた、君の星だ"),
            yazaki.explain("こうして再び星が生まれた",
                "翌日から少しずつ星が空に戻り、天文台は一ヶ月が経った今でも毎晩観測の為に稼働をしている"),
            )


def future_observatory(w: World):
    # NOTE: omit
    yazaki, shino, chito = w.get('yazaki'), w.get('shino'), w.get('chito')
    return w.scene("天文台の未来",
            w.plot_note("廃棄処分された天文台にこっそり忍び込む、老いた$yazaki"),
            w.plot_note("天文台は新しくなり、そこの職員として彼が、$chitoがやってくるらしい"),
            w.plot_note("$yazakiはおめでとうと、夢を忘れないようにというメッセージを宝箱に残した"),
            w.cmd.change_stage("Observatory"),
            yazaki.be("苔むした天文台の事務室で、古いノートが置かれている"),
            yazaki.do("そのノートの埃を払い、手に取る$S"),
            yazaki.do("老人の正体は$Sだった"),
            yazaki.think("昔、夢を思い出したときの話を回想していた"),
            "宝箱はかつて$chitoから貰ったもの",
            yazaki.do("今度近くに新しい天文台が作られ、そこに職員として彼が来るらしい",
                "その彼にこのノートのページを入れた宝箱を渡そうと準備した"),
            yazaki.do("夢を忘れない、とマジックで書かれたその下に「$chitoへ」と書き加えた"),
            )
